#!/bin/bash

function ask_for_password() {
  local password
  read -r -p "Please create a password: " password
  echo "$password"
}

function ask_for_more_characters() {
  local has_enough_characters
  if [[ $has_enough_characters == "false" ]]; then
    echo "Please make your password at least 7 characters long"
  fi
}

function ask_for_special_characters() {
  local has_special_char
  if [[ $has_special_char == "false" ]]; then
    echo "Please use at least 1 special character"
  fi
}

function has_enough_characters() {
  local password="$1"
  local min_char_length=6
  local actual_char_length=${#password}
  if [[ $min_char_length -gt $actual_char_length ]]; then
    echo false
  else
    echo true
  fi
}

function has_special_characters() {
  local password="$1"
  local has_special_char=true
  local special_characters=['!@#$%^&*()_+']
  if [[ ! $password =~ $special_characters ]]; then
    echo false
  else
    echo true
  fi
}

function main() {
  local password
  password=$(ask_for_password)

  local enough_chars
  local special_chars

  enough_chars=$(has_enough_characters "$password")
  special_chars=$(has_special_characters "$password")

  echo "enough_chars=$enough_chars"
  echo "special_chars=$special_chars"

  until [[ $enough_chars == "true" && $special_chars == "true" ]]; do
    printf "Please use correct password format\n"
    echo "enough_chars=$enough_chars"
    echo "special_chars=$special_chars"

    password=$(ask_for_password)
    enough_chars=$(has_enough_characters "$password")
    special_chars=$(has_special_characters "$password")
  done
}

main
